<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bms Note : Tableau Intelligent de Suivi Scolaire</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #f5f7fa;
            --bg-container: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #555;
            --border-color: #ddd;
            --accent-color: #2ecc71;
            --header-bg: #333;
            --header-text: #fff;
            --row-odd: #f8f9fa;
            --row-even: #ffffff;
            --row-hover: #e8f5e9;
            --input-bg: #fff;
            --input-border: #ddd;
            --summary-bg: linear-gradient(135deg, #333 0%, #555 100%);
            --summary-text: white;
            --card-bg: rgba(255, 255, 255, 0.2);
            --matiere-bg: #ecf0f1;
            --result-bg: #fff9c4;

            /* Grade Colors */
            --grade-bad: #e74c3c;
            --grade-avg: #f39c12;
            --grade-good: #27ae60;
        }

        .dark-mode {
            --bg-body: #1a1a1a;
            --bg-container: #2d2d2d;
            --text-primary: #ecf0f1;
            --text-secondary: #bdc3c7;
            --border-color: #444;
            --accent-color: #2ecc71;
            --header-bg: #111;
            --header-text: #eee;
            --row-odd: #333;
            --row-even: #2d2d2d;
            --row-hover: #3d3d3d;
            --input-bg: #444;
            --input-border: #555;
            --summary-bg: linear-gradient(135deg, #000 0%, #222 100%);
            --summary-text: #ddd;
            --card-bg: rgba(255, 255, 255, 0.05);
            --matiere-bg: #34495e;
            --result-bg: #4a4a4a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-body);
            color: var(--text-primary);
            padding: 20px;
            min-height: 100vh;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: var(--bg-container);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: background 0.3s ease;
        }

        .header-controls {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
        }

        .theme-toggle {
            background: none;
            border: 2px solid var(--text-secondary);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: var(--text-secondary);
            color: var(--bg-container);
        }

        h1 {
            color: var(--accent-color);
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .table-wrapper {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            min-width: 1200px;
        }

        thead {
            background: var(--header-bg);
            color: var(--header-text);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            border: 1px solid var(--border-color);
            white-space: nowrap;
        }

        .section-header {
            background: rgba(255, 255, 255, 0.1) !important;
            font-weight: bold;
        }

        td {
            padding: 12px 8px;
            text-align: center;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        tbody tr:nth-child(odd) {
            background-color: var(--row-odd);
        }

        tbody tr:nth-child(even) {
            background-color: var(--row-even);
        }

        tbody tr:hover {
            background-color: var(--row-hover);
            transition: background-color 0.2s ease;
        }

        .matiere {
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            background-color: var(--matiere-bg) !important;
            padding-left: 15px;
        }

        input {
            width: 60px;
            padding: 8px;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
            background: var(--input-bg);
            color: var(--text-primary);
            transition: all 0.2s;
            font-weight: 600;
        }

        input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.2);
        }

        /* Grade Color Classes */
        .grade-bad {
            color: var(--grade-bad);
        }

        .grade-avg {
            color: var(--grade-avg);
        }

        .grade-good {
            color: var(--grade-good);
        }

        .moyenne,
        .coefficient,
        .total {
            background-color: var(--result-bg) !important;
            font-weight: bold;
            color: var(--text-primary);
        }

        .summary {
            margin-top: 40px;
            padding: 30px;
            background: var(--summary-bg);
            color: var(--summary-text);
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .summary h2 {
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-item {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .summary-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .summary-value {
            font-size: 2.5em;
            font-weight: 700;
        }

        .legend {
            margin-top: 30px;
            padding: 20px;
            background: var(--row-odd);
            border-left: 4px solid var(--accent-color);
            border-radius: 6px;
        }

        .legend h3 {
            color: var(--accent-color);
            margin-bottom: 10px;
        }

        .legend p {
            margin: 5px 0;
            color: var(--text-secondary);
        }

        .actions {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .btn {
            padding: 12px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, opacity 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-reset {
            background-color: #e74c3c;
            color: white;
        }

        .btn-print {
            background-color: #3498db;
            color: white;
        }

        @media print {
            body {
                background: white;
                padding: 0;
                color: black;
            }

            .container {
                box-shadow: none;
                padding: 0;
                width: 100%;
                max-width: 100%;
            }

            .actions,
            .theme-toggle,
            .subtitle,
            .legend p[style*="italic"] {
                display: none;
            }

            h1 {
                font-size: 1.5em;
                margin-top: 0;
                color: black;
            }

            table {
                font-size: 10px;
                min-width: 0;
            }

            th,
            td {
                padding: 4px;
                border: 1px solid #000;
            }

            input {
                border: none;
                background: transparent;
                width: auto;
                padding: 0;
                text-align: center;
                color: black !important;
            }

            thead {
                background: #eee;
                color: black;
                position: static;
            }

            .section-header {
                background: #ddd !important;
            }

            .matiere {
                background-color: #f0f0f0 !important;
                color: black;
            }

            .moyenne,
            .coefficient,
            .total {
                background-color: #fff !important;
                border: 1px solid #000;
                color: black;
            }

            .summary {
                background: white;
                color: black;
                border: 1px solid #000;
                page-break-inside: avoid;
                box-shadow: none;
            }

            .summary-item {
                background: #f9f9f9;
                border: 1px solid #eee;
                color: black;
            }

            .legend {
                page-break-inside: avoid;
                border: 1px solid #000;
                background: white;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header-controls">
            <button class="theme-toggle" onclick="toggleTheme()">üåô Mode Sombre</button>
        </div>
        <h1>üéì Bms Note</h1>
        <p class="subtitle">Tableau Intelligent de Suivi Scolaire - Terminale D</p>
        <div class="student-info-container" style="text-align: center; margin-bottom: 20px;">
            <label for="studentName" style="font-weight: 600; color: var(--text-secondary);">√âl√®ve : </label>
            <input type="text" id="studentName" placeholder="Entrez votre nom"
                style="width: 250px; text-align: left; padding-left: 10px;">
        </div>

        <div class="table-wrapper">
            <table id="notesTable">
                <thead>
                    <tr>
                        <th rowspan="2">Mati√®re</th>
                        <th colspan="6" class="section-header">Interrogations</th>
                        <th colspan="4" class="section-header">Devoirs</th>
                        <th rowspan="2">Moyenne</th>
                        <th rowspan="2">Appr√©ciation</th>
                        <th rowspan="2">Coefficient</th>
                        <th rowspan="2">Total Points</th>
                    </tr>
                    <tr>
                        <th>Interro 1</th>
                        <th>Interro 2</th>
                        <th>Interro 3</th>
                        <th>Interro 4</th>
                        <th>Interro 5</th>
                        <th>Interro 6</th>
                        <th>Devoir 1</th>
                        <th>Devoir 2</th>
                        <th>Devoir 3</th>
                        <th>Devoir 4</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Math√©matiques -->
                    <tr data-coeff="4">
                        <td class="matiere">Math√©matiques</td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td class="moyenne">-</td>
                        <td class="appreciation">-</td>
                        <td class="coefficient">4</td>
                        <td class="total">-</td>
                    </tr>

                    <!-- SVT -->
                    <tr data-coeff="4">
                        <td class="matiere">SVT</td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td class="moyenne">-</td>
                        <td class="appreciation">-</td>
                        <td class="coefficient">4</td>
                        <td class="total">-</td>
                    </tr>

                    <!-- Physique-Chimie -->
                    <tr data-coeff="4">
                        <td class="matiere">Physique-Chimie</td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td class="moyenne">-</td>
                        <td class="appreciation">-</td>
                        <td class="coefficient">4</td>
                        <td class="total">-</td>
                    </tr>

                    <!-- Fran√ßais -->
                    <tr data-coeff="3">
                        <td class="matiere">Fran√ßais</td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td class="moyenne">-</td>
                        <td class="appreciation">-</td>
                        <td class="coefficient">3</td>
                        <td class="total">-</td>
                    </tr>

                    <!-- Philosophie -->
                    <tr data-coeff="2">
                        <td class="matiere">Philosophie</td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td class="moyenne">-</td>
                        <td class="appreciation">-</td>
                        <td class="coefficient">2</td>
                        <td class="total">-</td>
                    </tr>

                    <!-- Histoire-G√©ographie -->
                    <tr data-coeff="2">
                        <td class="matiere">Histoire-G√©ographie</td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td class="moyenne">-</td>
                        <td class="appreciation">-</td>
                        <td class="coefficient">2</td>
                        <td class="total">-</td>
                    </tr>

                    <!-- Anglais -->
                    <tr data-coeff="1">
                        <td class="matiere">Anglais</td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="devoir"></td>
                        <td class="moyenne">-</td>
                        <td class="appreciation">-</td>
                        <td class="coefficient">1</td>
                        <td class="total">-</td>
                    </tr>

                    <!-- EPS -->
                    <tr data-coeff="1" data-art="true">
                        <td class="matiere">EPS</td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td class="moyenne">-</td>
                        <td class="appreciation">-</td>
                        <td class="coefficient">1</td>
                        <td class="total">-</td>
                    </tr>

                    <!-- AP/MUS -->
                    <tr data-coeff="1" data-art="true">
                        <td class="matiere">AP/MUS</td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td><input type="number" step="0.25" min="0" max="20" class="interro"></td>
                        <td class="moyenne">-</td>
                        <td class="appreciation">-</td>
                        <td class="coefficient">1</td>
                        <td class="total">-</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="actions">
            <button class="btn btn-reset" onclick="resetData()">
                üóëÔ∏è R√©initialiser tout
            </button>
            <button class="btn btn-print" onclick="window.print()">
                üñ®Ô∏è Imprimer / PDF
            </button>
        </div>

        <div class="summary">
            <h2>üìä R√©sum√© G√©n√©ral</h2>

            <div class="progress-container"
                style="margin: 20px 0; background: rgba(0,0,0,0.1); border-radius: 10px; height: 20px; overflow: hidden;">
                <div id="progressBar"
                    style="width: 0%; height: 100%; background: linear-gradient(90deg, #e74c3c, #f39c12, #2ecc71); transition: width 0.5s ease;">
                </div>
            </div>

            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-label">Total Points</div>
                    <div class="summary-value" id="totalPoints">0.00</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Total Coefficients</div>
                    <div class="summary-value" id="totalCoeffs">22</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Moyenne G√©n√©rale</div>
                    <div class="summary-value" id="moyenneGenerale">0.00</div>
                </div>
            </div>

            <div class="goal-calculator"
                style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.2);">
                <h3 style="margin-bottom: 15px; font-size: 1.2em;">üéØ Objectif Moyenne</h3>
                <div style="display: flex; gap: 10px; justify-content: center; align-items: center; flex-wrap: wrap;">
                    <label>Je vise :</label>
                    <input type="number" id="targetGrade" min="0" max="20" step="0.5" placeholder="14"
                        style="width: 80px;">
                    <span>/ 20</span>
                    <button class="btn" onclick="calculateGoal()"
                        style="padding: 8px 15px; font-size: 0.9em; background: var(--accent-color); color: white;">Calculer</button>
                </div>
                <p id="goalResult" style="margin-top: 15px; font-weight: bold; min-height: 24px;"></p>
            </div>
        </div>

        <div class="legend">
            <h3>üìã Syst√®me de Coefficients</h3>
            <p><strong>Interrogations :</strong> Coefficient 1 (sauf AP/MUS et EPS)</p>
            <p><strong>Devoirs :</strong> Coefficient 2 (sauf AP/MUS et EPS)</p>
            <p><strong>AP/MUS et EPS :</strong> Toutes √©valuations = Coefficient 1</p>
            <p style="margin-top: 10px; font-style: italic;">Les moyennes sont calcul√©es automatiquement √† chaque saisie
                de note.</p>
        </div>
    </div>

    <script>
        const table = document.getElementById('notesTable');
        const inputs = table.querySelectorAll('input');

        // Theme Toggle Logic
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);

            const btn = document.querySelector('.theme-toggle');
            btn.textContent = isDark ? '‚òÄÔ∏è Mode Clair' : 'üåô Mode Sombre';
        }

        // Initialize Theme
        if (localStorage.getItem('darkMode') === 'true') {
            toggleTheme();
        }

        function getColorClass(value) {
            if (value < 10) return 'grade-bad';
            if (value < 14) return 'grade-avg';
            return 'grade-good';
        }

        function updateInputColor(input) {
            const value = parseFloat(input.value);
            input.classList.remove('grade-bad', 'grade-avg', 'grade-good');
            if (!isNaN(value) && value >= 0) {
                input.classList.add(getColorClass(value));
            }
        }

        function calculateRow(row) {
            const isArt = row.dataset.art === 'true';
            const coeff = parseInt(row.dataset.coeff);

            const interros = row.querySelectorAll('.interro');
            const devoirs = row.querySelectorAll('.devoir');

            let totalPoints = 0;
            let totalCoeffs = 0;

            // Calcul des interrogations
            interros.forEach(input => {
                const value = parseFloat(input.value);
                updateInputColor(input); // Update color
                if (!isNaN(value) && value >= 0) {
                    totalPoints += value * 1;
                    totalCoeffs += 1;
                }
            });

            // Calcul des devoirs
            if (!isArt) {
                devoirs.forEach(input => {
                    const value = parseFloat(input.value);
                    updateInputColor(input); // Update color
                    if (!isNaN(value) && value >= 0) {
                        totalPoints += value * 2;
                        totalCoeffs += 2;
                    }
                });
            }

            const moyenne = totalCoeffs > 0 ? totalPoints / totalCoeffs : 0;
            const totalMatiere = moyenne * coeff;

            const moyenneCell = row.querySelector('.moyenne');
            const totalCell = row.querySelector('.total');

            moyenneCell.textContent = moyenne > 0 ? moyenne.toFixed(2) : '-';
            totalCell.textContent = totalMatiere > 0 ? totalMatiere.toFixed(2) : '-';

            // Color code the average
            moyenneCell.className = 'moyenne'; // reset
            if (moyenne > 0) {
                moyenneCell.classList.add(getColorClass(moyenne));
            }

            calculateGeneral();
        }

        function calculateGeneral() {
            const rows = table.querySelectorAll('tbody tr');
            let totalPoints = 0;
            let totalCoeffs = 0;

            rows.forEach(row => {
                const moyenneCell = row.querySelector('.moyenne');
                const moyenne = parseFloat(moyenneCell.textContent);
                const coeff = parseInt(row.dataset.coeff);

                if (!isNaN(moyenne) && moyenne > 0) {
                    totalPoints += moyenne * coeff;
                    totalCoeffs += coeff;
                }
            });

            const moyenneGenerale = totalCoeffs > 0 ? totalPoints / totalCoeffs : 0;

            document.getElementById('totalPoints').textContent = totalPoints.toFixed(2);
            document.getElementById('totalCoeffs').textContent = totalCoeffs;

            const genEl = document.getElementById('moyenneGenerale');
            genEl.textContent = moyenneGenerale.toFixed(2);

            // Color code general average
            genEl.className = 'summary-value'; // reset
            if (moyenneGenerale > 0) {
                genEl.style.color = moyenneGenerale < 10 ? '#e74c3c' : (moyenneGenerale < 14 ? '#f39c12' : '#2ecc71');
            } else {
                genEl.style.color = 'inherit';
            }
        }

        function resetData() {
            if (confirm('√ätes-vous s√ªr de vouloir tout effacer ? Cette action est irr√©versible.')) {
                inputs.forEach((input, index) => {
                    input.value = '';
                    localStorage.removeItem(`note_${index}`);
                    const row = input.closest('tr');
                    calculateRow(row);
                });
            }
        }

        inputs.forEach((input, index) => {
            // Restaurer la valeur sauvegard√©e si elle existe
            const savedValue = localStorage.getItem(`note_${index}`);
            if (savedValue) {
                input.value = savedValue;
                // D√©clencher le calcul initial
                const row = input.closest('tr');
                calculateRow(row);
            }

            input.addEventListener('input', function () {
                const row = this.closest('tr');
                calculateRow(row);
                // Sauvegarder la valeur
                localStorage.setItem(`note_${index}`, this.value);
            });
        });

        // Student Name Persistence
        const studentNameInput = document.getElementById('studentName');
        if (localStorage.getItem('studentName')) {
            studentNameInput.value = localStorage.getItem('studentName');
        }
        studentNameInput.addEventListener('input', function () {
            localStorage.setItem('studentName', this.value);
        });

        function getAppreciation(moyenne) {
            if (moyenne < 8) return "Fragile";
            if (moyenne < 10) return "Insuffisant";
            if (moyenne < 12) return "Passable";
            if (moyenne < 14) return "Assez Bien";
            if (moyenne < 16) return "Bien";
            if (moyenne < 18) return "Tr√®s Bien";
            return "Excellent";
        }

        function calculateGoal() {
            const target = parseFloat(document.getElementById('targetGrade').value);
            const totalCoeffs = parseFloat(document.getElementById('totalCoeffs').textContent);
            const currentPoints = parseFloat(document.getElementById('totalPoints').textContent);
            const resultEl = document.getElementById('goalResult');

            if (isNaN(target)) {
                resultEl.textContent = "Veuillez entrer une moyenne vis√©e.";
                resultEl.style.color = "var(--text-secondary)";
                return;
            }

            const pointsNeeded = (target * totalCoeffs) - currentPoints;

            if (pointsNeeded <= 0) {
                resultEl.textContent = "üéâ Bravo ! Vous avez d√©j√† atteint cet objectif !";
                resultEl.style.color = "var(--grade-good)";
            } else {
                resultEl.textContent = `Il vous manque ${pointsNeeded.toFixed(2)} points pour atteindre ${target}/20.`;
                resultEl.style.color = "var(--grade-avg)";
            }
        }

        // Update calculateRow to handle appreciation
        const originalCalculateRow = calculateRow;
        calculateRow = function (row) {
            // Re-implementing parts of calculateRow to inject appreciation logic
            // We can't easily hook into the middle, so we'll just call the original logic 
            // (which we can't do easily because I'm replacing the function entirely in this scope, 
            // but I can just copy the logic since I am editing the file).

            // Actually, better to just rewrite the function content in the file edit above? 
            // No, I am in the JS block now. I will just overwrite the calculateRow function in the file.

            const isArt = row.dataset.art === 'true';
            const coeff = parseInt(row.dataset.coeff);

            const interros = row.querySelectorAll('.interro');
            const devoirs = row.querySelectorAll('.devoir');

            let totalPoints = 0;
            let totalCoeffs = 0;

            interros.forEach(input => {
                const value = parseFloat(input.value);
                updateInputColor(input);
                if (!isNaN(value) && value >= 0) {
                    totalPoints += value * 1;
                    totalCoeffs += 1;
                }
            });

            if (!isArt) {
                devoirs.forEach(input => {
                    const value = parseFloat(input.value);
                    updateInputColor(input);
                    if (!isNaN(value) && value >= 0) {
                        totalPoints += value * 2;
                        totalCoeffs += 2;
                    }
                });
            }

            const moyenne = totalCoeffs > 0 ? totalPoints / totalCoeffs : 0;
            const totalMatiere = moyenne * coeff;

            const moyenneCell = row.querySelector('.moyenne');
            const totalCell = row.querySelector('.total');
            const appCell = row.querySelector('.appreciation');

            moyenneCell.textContent = moyenne > 0 ? moyenne.toFixed(2) : '-';
            totalCell.textContent = totalMatiere > 0 ? totalMatiere.toFixed(2) : '-';

            // Appreciation Logic
            if (moyenne > 0) {
                appCell.textContent = getAppreciation(moyenne);
                appCell.style.fontWeight = "bold";
                appCell.style.color = getColorClass(moyenne) === 'grade-bad' ? 'var(--grade-bad)' :
                    getColorClass(moyenne) === 'grade-avg' ? 'var(--grade-avg)' : 'var(--grade-good)';
            } else {
                appCell.textContent = '-';
                appCell.style.color = 'inherit';
            }

            moyenneCell.className = 'moyenne';
            if (moyenne > 0) {
                moyenneCell.classList.add(getColorClass(moyenne));
            }

            calculateGeneral();
        };

        // Update calculateGeneral to handle Progress Bar
        const originalCalculateGeneral = calculateGeneral;
        calculateGeneral = function () {
            const rows = table.querySelectorAll('tbody tr');
            let totalPoints = 0;
            let totalCoeffs = 0;

            rows.forEach(row => {
                const moyenneCell = row.querySelector('.moyenne');
                const moyenne = parseFloat(moyenneCell.textContent);
                const coeff = parseInt(row.dataset.coeff);

                if (!isNaN(moyenne) && moyenne > 0) {
                    totalPoints += moyenne * coeff;
                    totalCoeffs += coeff;
                }
            });

            const moyenneGenerale = totalCoeffs > 0 ? totalPoints / totalCoeffs : 0;

            document.getElementById('totalPoints').textContent = totalPoints.toFixed(2);
            document.getElementById('totalCoeffs').textContent = totalCoeffs;

            const genEl = document.getElementById('moyenneGenerale');
            genEl.textContent = moyenneGenerale.toFixed(2);

            genEl.className = 'summary-value';
            if (moyenneGenerale > 0) {
                genEl.style.color = moyenneGenerale < 10 ? '#e74c3c' : (moyenneGenerale < 14 ? '#f39c12' : '#2ecc71');
            } else {
                genEl.style.color = 'inherit';
            }

            // Progress Bar Update
            const progressBar = document.getElementById('progressBar');
            const percentage = (moyenneGenerale / 20) * 100;
            progressBar.style.width = `${percentage}%`;
        };
    </script>
</body>

</html>
